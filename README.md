# 쿠팡 쿠폰 자동발급 프로그램 사용설명서

> 매일 자정에 자동으로 쿠폰을 발급하는 프로그램입니다.

---

## 📋 목차

1. [설치 방법](#설치-방법)
2. [엑셀 파일 작성](#엑셀-파일-작성)
3. [확인 방법](#확인-방법)
4. [제거 방법](#제거-방법)
5. [⚠️ 주의사항](#️-주의사항)
6. [문제 해결](#문제-해결)

---

## 설치 방법

### 0. 필요한 정보 준비

설치하기 전에 다음 정보를 준비하세요:

- **Access Key / Secret Key**: 쿠팡 판매자 센터(쿠팡윙) → 프로필의 추가판매정보 → OPEN API 키 발급
- **Vendor ID**: 쿠팡 판매자 센터 → 프로필 → 업체코드
- **User ID**: 쿠팡 판매자 센터 로그인 ID
- **옵션ID**: 쿠팡 판매자 센터 → 상품 관리 → 상품 조회/수정 → 상품클릭 → 옵션 - 옵션수정 → 옵션ID 컬럼

<details>
<summary><b>📖 자세한 방법 보기 (클릭)</b></summary>

#### Access Key / Secret Key 발급

1. 쿠팡 판매자 센터(https://wing.coupang.com) 로그인
2. **프로필** → **추가판매정보** 클릭
3. **OPEN API 키 발급** 섹션에서 키 발급
4. Access Key와 Secret Key 복사
5. **⚠️ 중요**: IP 주소 입력란에 **이 프로그램이 실행될 서버의 IP 주소**를 반드시 입력하세요!
   - IP 주소를 정확히 입력하지 않으면 프로그램이 동작하지 않습니다
   - 예: `123.45.67.89`

> 💡 Access Key와 Secret Key는 언제든지 다시 확인할 수 있습니다.

#### Vendor ID 확인

1. 쿠팡 판매자 센터 로그인
2. **프로필** 클릭
3. **업체코드**가 Vendor ID입니다

#### User ID 확인

쿠팡 판매자 센터 로그인 시 사용하는 ID입니다.

#### 옵션ID 확인

1. 쿠팡 판매자 센터 로그인
2. **상품 관리** → **상품 조회/수정** 클릭
3. 쿠폰을 적용할 상품 클릭
4. **옵션** → **옵션수정** 클릭
5. **옵션ID** 컬럼에서 확인
6. 여러 옵션에 적용하려면 쉼표로 구분 (예: `123456, 789012`)

**개수 제한**:
- **즉시할인쿠폰**: 최대 10,000개까지 가능
- **다운로드쿠폰**: 최대 100개까지만 가능

</details>

### 1. 엑셀 파일 준비

프로그램 폴더의 `examples` 폴더에서 파일 하나를 복사해서 이름을 `coupons.xlsx`로 바꾸세요.

```
basic.xlsx → coupons.xlsx (이름 변경)
```

엑셀 파일을 열어서 쿠폰 정보를 입력하세요. (자세한 내용은 [엑셀 파일 작성](#엑셀-파일-작성) 참고)

### 2. 서버에 업로드

프로그램 파일과 `coupons.xlsx` 파일을 리눅스 서버의 같은 폴더에 업로드하세요.

**중요**: `coupons.xlsx` 파일은 반드시 프로그램 파일과 같은 폴더에 넣으세요!

```
~/my-coupons/
├── coupang_coupon_issuer  ← 프로그램 파일
└── coupons.xlsx           ← 엑셀 파일
```

### 3. 설치 실행

터미널(SSH)로 서버에 접속해서 다음 명령어를 실행하세요:

```bash
# 1. 프로그램 파일이 있는 폴더로 이동
cd ~/my-coupons

# 2. 시스템 준비 (최초 1회만, sudo 필요)
sudo ./coupang_coupon_issuer setup

# 3. 설치 실행
./coupang_coupon_issuer install
```

마지막 줄 실행하면 다음 정보를 차례대로 입력하라고 나옵니다:
- Access Key
- Secret Key
- User ID
- Vendor ID

모두 입력하면 설치 완료!

---

## 엑셀 파일 작성

### 엑셀 구조 (9개 컬럼)

| 컬럼 | 이름 | 예시 |
|------|------|------|
| A | 쿠폰이름 | "신규회원 10% 할인" |
| B | 쿠폰타입 | "즉시할인쿠폰" 또는 "다운로드쿠폰" |
| C | 쿠폰유효기간 | 30 (일 단위) |
| D | 할인방식 | "정률할인", "정액할인", "수량별 정액할인" |
| E | 할인금액/비율 | 10 (10% 또는 10원) |
| F | 최소구매금액 | 10000 (원 단위, 다운로드쿠폰만) |
| G | 최대할인금액 | 5000 (원 단위) |
| H | 발급개수 | 100 (다운로드쿠폰만, 일일 발급개수로 동작) |
| I | 옵션ID | "123456, 789012" (쉼표로 구분) |

### 🚨 절대 지켜야 할 규칙

- ❌ **컬럼 순서, 개수, 이름을 절대 바꾸지 마세요**
- ❌ **헤더(첫 번째 줄)를 수정하지 마세요**
- ✅ **데이터 행만 추가/수정/삭제하세요**
- ✅ **셀 너비/높이 조절은 괜찮습니다**

**다운로드쿠폰 전용 필드**:
- **발급개수**: 다운로드쿠폰일 때만 입력하세요 (즉시할인쿠폰은 비워둠)
- **최소구매금액**: 다운로드쿠폰일 때만 입력하세요 (즉시할인쿠폰은 비워둠)

> 형식을 조금이라도 바꾸면 프로그램이 동작하지 않습니다!

### 작성 예시

**즉시할인 쿠폰**:
- 쿠폰이름: VIP 20% 할인
- 쿠폰타입: 즉시할인
- 쿠폰유효기간: 30
- 할인방식: 정률할인
- 할인금액/비율: 20
- 최소구매금액: (비워둠)
- 최대할인금액: 50000
- 발급개수: (비워둠)
- 옵션ID: 1234567890, 9876543210

**다운로드 쿠폰**:
- 쿠폰이름: 신규회원 3000원 할인
- 쿠폰타입: 다운로드쿠폰
- 쿠폰유효기간: 15
- 할인방식: 정액할인
- 할인금액/비율: 3000
- 최소구매금액: 10000
- 최대할인금액: (비워둠, 정액할인이므로 생략 가능)
- 발급개수: 500
- 옵션ID: 3226138951, 4802314648

> 💡 **정액할인**의 경우 최대할인금액은 비워둬도 됩니다.

---

## 확인 방법

### 엑셀 파일 검증 (선택사항)

엑셀 파일을 수정한 후 이상이 없는지 미리 확인하고 싶다면:

```bash
cd ~/my-coupons
./coupang_coupon_issuer verify
```

정상이면 쿠폰 목록이 표 형식으로 나옵니다.

> 💡 이 검증은 필수가 아닙니다. 엑셀 파일에 문제가 있으면 자동 실행 시 오류가 발생합니다.

### 수동 실행 (테스트)

자정까지 기다리지 않고 바로 쿠폰이 잘 발급되는지 확인하려면:

```bash
cd ~/my-coupons
./coupang_coupon_issuer issue
```

실행 후 쿠팡 판매자 센터에서 쿠폰이 제대로 발급되었는지 확인하세요.

---

## 제거 방법

프로그램을 완전히 제거하려면:

```bash
# 1. 자동 실행 제거
cd ~/my-coupons
./coupang_coupon_issuer uninstall

# 2. 파일 삭제 (원하는 경우)
cd ~
rm -rf my-coupons
```

---

## ⚠️ 주의사항

### 1. API 키 발급 시 IP 주소 필수 설정

**가장 중요합니다!** Access Key / Secret Key 발급 시 반드시 **서버의 IP 주소**를 입력해야 합니다.

- IP 주소를 입력하지 않거나 잘못 입력하면 프로그램이 동작하지 않습니다.
- 서버 IP 주소는 서버 관리자에게 문의하거나, 서버에서 `curl ifconfig.me` 명령어로 확인할 수 있습니다.

### 2. 폴더를 옮기지 마세요

설치 후 프로그램 폴더를 다른 위치로 옮기면 자동 실행이 작동하지 않습니다.

**폴더를 옮겨야 한다면**:
1. `./coupang_coupon_issuer uninstall` 실행
2. 폴더 이동
3. 새 위치에서 `./coupang_coupon_issuer install` 다시 실행

### 3. 쿠폰 예산 차감

쿠폰을 발급하면 쿠팡의 "자유계약" 예산에서 비용이 차감됩니다.

### 4. 엑셀 파일명 고정

엑셀 파일 이름은 반드시 `coupons.xlsx`여야 합니다.

### 5. 엑셀 형식 엄수

엑셀 파일 형식을 조금이라도 바꾸면 프로그램이 동작하지 않습니다.

### 6. 검증 명령어 활용 (선택사항)

엑셀 파일을 수정한 후에는 `verify` 명령어로 미리 확인해볼 수 있습니다.

---

## 문제 해결

### 오류가 발생했을 때

1. **엑셀 파일 검증**
   ```bash
   cd ~/my-coupons
   ./coupang_coupon_issuer verify
   ```
   엑셀 파일에 문제가 있다면 어떤 부분이 잘못되었는지 표시됩니다.

2. **개발자에게 문의**
   
   엑셀 파일에 문제가 없는데도 오류가 발생한다면:
   - `issuer.log` 파일을 개발자에게 보내주세요
   - `coupons.xlsx` 엑셀 파일도 함께 보내주세요
   - 두 파일을 함께 보내면 더 빠르게 해결됩니다

### 자주 발생하는 오류

**"IP 주소가 허용되지 않음" / "인증 오류"**
- API 키 발급 시 서버 IP 주소를 입력했는지 확인하세요
- IP 주소가 정확한지 확인: 서버에서 `curl ifconfig.me` 실행
- 쿠팡 판매자 센터 → 프로필 → 추가판매정보 → OPEN API 키 발급에서 IP 주소 재설정

**"Cron이 설치되어 있지 않습니다"**
```bash
sudo ./coupang_coupon_issuer setup
```

**"엑셀 파일을 찾을 수 없습니다"**
- 파일 이름이 `coupons.xlsx`인지 확인
- 파일이 프로그램 파일과 같은 폴더에 있는지 확인

**"엑셀 형식 오류"**
- `verify` 명령어로 어떤 부분이 잘못되었는지 확인
- 예제 파일(`examples/` 폴더)과 비교해보세요

---

## 개발자 문서

개발에 참여하거나 프로젝트를 이해하고 싶다면:

- **[docs/DEVELOPMENT.md](docs/DEVELOPMENT.md)** - 개발자 가이드
  - 개발 환경 설정
  - 프로젝트 구조 및 철학
  - 테스트 및 빌드 방법
  - 현재 TODO 및 알려진 이슈

- **[CLAUDE.md](CLAUDE.md)** - AI 개발 가이드 (상세)
- **[docs/DEV_LOG.md](docs/DEV_LOG.md)** - 개발 로그
- **[docs/adr/](docs/adr/)** - 아키텍처 결정 기록

---

**마지막 업데이트**: 2025-12-27  
**버전**: 3.0

